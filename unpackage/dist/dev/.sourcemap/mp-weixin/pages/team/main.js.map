{"version":3,"sources":["uni-app:///main.js","webpack:///C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/team/main.vue?2fb3","webpack:///C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/team/main.vue?a29b","webpack:///C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/team/main.vue?d871","webpack:///C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/team/main.vue?70d1","uni-app:///pages/team/main.vue"],"names":["createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","is_leader","Number","item"],"mappings":";;;;wEAAA,qBACA,sBACA,wC,mDACAA,EAAWC,a;;;;2DCHX,wNACIC,EADJ,2KAQIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,WACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,sBACZ,aAAAF,E;;;;2GCtBf,ypC;;;;2GCAA,IAAIG,EAAJ,0LACA,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eACJH,EAAII,MAAMC,IAEjBC,GAAmB,EACnBC,EAAkB,GACtBR,EAAOS,eAAgB,G;;;;2DCRvB,uwBAAgtB,eAAG,G;;;;0hECcntB,CACE,WAAF,CACI,SAAJ,EACI,YAAJ,EACI,WAAJ,EACI,YAAJ,GAEE,KAPF,WAQI,MAAJ,CACM,WAAN,EACM,SAAN,GACM,oBAAN,GAEM,aAAN,GAEM,aAAN,EAEM,UAAN,GAEM,YAAN,EAEM,mBAAN,EAEM,QAAN,EACM,cAAN,OAGE,QAAF,CACI,UADJ,WACA,+HACA,iCAEA,UAKA,gBAHA,gBALA,8CAWI,YAZJ,WAYA,4IACA,GACA,+BACA,MACA,iCACA,sBACA,2CAEA,YARA,SAUA,SAVA,OAUA,EAVA,OAWA,UACA,SACA,GACA,iCACA,YACA,WACA,kCACA,4CACA,0BACA,WACA,yDACA,0CACA,oCAEA,4BAEA,gBA3BA,8CA8BI,YA1CJ,WA2CM,GAAN,YACQ,IAAR,cACQ,KAAR,KAEM,KAAN,uBACQ,SAAR,2BACQ,SAAR,EACQ,oBAAR,4BAGI,aArDJ,WAqDA,WACA,2CACM,QAAN,eACM,KAAN,KACQ,IAAR,2BACQ,KAAR,CACU,oBAAV,KAEM,MAAN,YACQ,QAAR,OACQ,EAAR,cAEQ,IAAR,8BAwBQ,GAvBA,EAAR,cACU,SAAV,aACU,aAAV,eACU,cAAV,QACU,YAAV,cACU,UAAV,YACU,YAAV,eAGQ,EAAR,8FAEQ,EAAR,iCAEQ,EAAR,+CAEQ,EAAR,yCAEQ,EAAR,uEACU,GADV,IAEYC,UAAWC,OAAOC,EAAKF,gBAE3B,EAAR,aAEA,oBACU,QAAV,aACU,IAAV,2CACA,2BACA,SACA,MACY,EAAZ,wBACY,EAAZ,sCACc,EAAd,cACA,mBACgB,cAAhB,mBAEA,YAME,OAtIF,WAsIA,WACI,cAAJ,oBACI,KAAJ,aACI,EAAJ,cACI,YAAJ,WACM,EAAN,iBACA,KACI,KAAJ,yCACI,QAAJ,2BAEE,kBAhJF,WAiJI,KAAJ,sBACM,KAAN,QACM,aAAN,aACM,WAAN,SAJA,MAMI,KAAJ,kBANA,EAMA,sBANA,EAMA,aACI,MAAJ,CACM,KAAN,4FAGE,OA3JF,WA4JI,cAAJ,qBAEE,SA9JF,WA+JI,cAAJ,sB","file":"pages/team/main.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/team/main.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./main.vue?vue&type=template&id=5be34c82&scoped=true&\"\nvar renderjs\nimport script from \"./main.vue?vue&type=script&lang=js&\"\nexport * from \"./main.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"5be34c82\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/team/main.vue\"\nexport default component.exports","export * from \"-!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--16-0!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./main.vue?vue&type=template&id=5be34c82&scoped=true&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./main.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./main.vue?vue&type=script&lang=js&\"","<template>\r\n\t<div v-if=\"page_show\">\r\n\t\t<stepFlow />\r\n    <productInfo :info=\"product_info\" />\r\n    <teamPeople :last_people_number=\"last_people_number\" :product_info=\"product_info\" :order_sn=\"order_sn\" :is_join=\"is_join\" :group_status=\"group_status\" :join_list=\"join_list\" :remain_time=\"remain_time\" @joinGroup=\"joinGroup\" />\r\n    <teamHistory :join_list=\"join_list\" />\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\n  import stepFlow from '@/components/team/stepFlow'\r\n  import productInfo from '@/components/team/product-info'\r\n  import teamPeople from '@/components/team/team-people'\r\n  import teamHistory from '@/components/team/team-history'\r\n  export default {\r\n    components: {\r\n      stepFlow,\r\n      productInfo,\r\n      teamPeople,\r\n      teamHistory\r\n    },\r\n    data () {\r\n      return {\r\n        page_show: false,\r\n        order_sn: '',\r\n        group_head_order_sn: '',\r\n        // 产品信息\r\n        product_info: {},\r\n        // 拼团状态\r\n        group_status: 0,\r\n        // 拼团人员\r\n        join_list: [],\r\n        // 剩余时间\r\n        remain_time: 0,\r\n        // 剩余人数\r\n        last_people_number: 0,\r\n        // 是否为加入拼图\r\n        is_join: 0,\r\n        time_interval: null\r\n      }\r\n    },\r\n    methods: {\r\n      async joinGroup () {\r\n        let productType = this.$root.$mp.query.product_type\r\n        // 0-单品，1-套餐\r\n        if (!Number(productType)) {\r\n          // 单品情况下先请求再跳转\r\n          this.productJump()\r\n        } else {\r\n          // 如果是套餐则直接跳\r\n          this.packageJump()\r\n        }\r\n      },\r\n      async productJump () {\r\n        let args = {\r\n          url: this.api('groupConfirmOrder'),\r\n          data: {\r\n            goods_id: this.product_info.goods_id,\r\n            coupon_instance_id: '',\r\n            group_head_order_sn: this.group_head_order_sn\r\n          },\r\n          loading: true\r\n        }\r\n        let res = await this.get(args)\r\n        if (res.status) {\r\n          const re = res.data\r\n          const q = {\r\n            goods_id: this.product_info.goods_id,\r\n            goods_num: 1,\r\n            spec_id: '',\r\n            address: JSON.stringify(re.address),\r\n            goods_list: JSON.stringify(re.goods_list || []),\r\n            total_price: re.total_price,\r\n            is_group: 1,\r\n            coupon_list: JSON.stringify(re.coupon.coupon_instance || []),\r\n            group_head_order_sn: this.group_head_order_sn,\r\n            is_coupon: re.group_detail.is_coupon\r\n          }\r\n          this.$nav('productConfirm', q)\r\n        } else {\r\n          this.$toast(res.msg)\r\n        }\r\n      },\r\n      packageJump () {\r\n        wx.setStorage({\r\n          key: 'package_ids',\r\n          data: []\r\n        })\r\n        this.$nav('packageConfirm', {\r\n          goods_id: this.product_info.goods_id,\r\n          is_group: 1,\r\n          group_head_order_sn: this.group_head_order_sn\r\n        })\r\n      },\r\n      getGroupData () {\r\n        let sn = this.$root.$mp.query.group_head_order_sn\r\n        console.log('发送团单号', sn)\r\n        this.get({\r\n          url: this.api('getGroupDetail'),\r\n          data: {\r\n            group_head_order_sn: sn\r\n          }\r\n        }).then(res => {\r\n          console.log(res)\r\n          uni.hideLoading()\r\n\r\n          const productInfo = res.data.group_product_detail\r\n          this.product_info = {\r\n            goods_id: productInfo.product_id,\r\n            product_name: productInfo.product_name,\r\n            product_thumb: productInfo.thumb,\r\n            group_price: productInfo.group_price,\r\n            goods_num: productInfo.goods_num,\r\n            group_needs: productInfo.group_needs\r\n          }\r\n\r\n          this.last_people_number = Number(res.data.group_detail.group_needs) - Number(res.data.group_detail.joined)\r\n\r\n          this.order_sn = res.data.my_join_order_sn\r\n\r\n          this.group_head_order_sn = res.data.group_head_order_sn\r\n\r\n          this.group_status = Number(res.data.group_status)\r\n\r\n          this.join_list = res.data.group_detail.join_list.map(item => ({\r\n            ...item,\r\n            is_leader: Number(item.is_leader)\r\n          }))\r\n          this.page_show = true\r\n\r\n          if (this.group_status === 1) {\r\n            console.log('开启倒计时')\r\n            const groupExpire = Number(res.data.group_detail.group_expire)\r\n            const nowTime = (Date.parse(new Date()) / 1000)\r\n            const remainTime = groupExpire - nowTime || 0\r\n            if (remainTime > 0) {\r\n              this.remain_time = parseInt(remainTime)\r\n              this.time_interval = setInterval(() => {\r\n                this.remain_time--\r\n                if (this.remain_time === 0) {\r\n                  clearInterval(this.time_interval)\r\n                }\r\n              }, 1000)\r\n            }\r\n          }\r\n        })\r\n      }\r\n    },\r\n    onShow () {\r\n      clearInterval(this.time_interval)\r\n      this.page_show = false\r\n      uni.showLoading()\r\n      setTimeout(() => {\r\n        this.getGroupData()\r\n      }, 2000)\r\n      this.is_join = this.$root.$mp.query.is_join ? 1 : 0\r\n      console.log(this.$root.$mp.query)\r\n    },\r\n    onShareAppMessage () {\r\n      this.$Tool.SetRecordScene({\r\n        page: 'share',\r\n        content_type: 'share_page',\r\n        content_id: '分享页面'\r\n      })\r\n      const { group_head_order_sn: headSn, product_type: productType } = this.$root.$mp.query\r\n      return {\r\n        path: `/pages/team/main?group_head_order_sn=${headSn}&product_type=${productType}&is_join=1`\r\n      }\r\n    },\r\n    onHide () {\r\n      clearInterval(this.time_interval)\r\n    },\r\n    onUnload () {\r\n      clearInterval(this.time_interval)\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n\r\n</style>\r\n"],"sourceRoot":""}