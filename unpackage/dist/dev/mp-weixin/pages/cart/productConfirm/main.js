(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/cart/productConfirm/main"],{271:
/*!*************************************************************************************************************!*\
  !*** C:/Users/Idler/Documents/HBuilderProjects/iKu/main.js?{"page":"pages%2Fcart%2FproductConfirm%2Fmain"} ***!
  \*************************************************************************************************************/
/*! no static exports found */function(e,n,t){"use strict";(function(e){t(/*! uni-pages */4);r(t(/*! vue */2));var n=r(t(/*! ./pages/cart/productConfirm/main.vue */272));function r(e){return e&&e.__esModule?e:{default:e}}e(n.default)}).call(this,t(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["createPage"])},272:
/*!****************************************************************************************!*\
  !*** C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/cart/productConfirm/main.vue ***!
  \****************************************************************************************/
/*! no static exports found */function(e,n,t){"use strict";t.r(n);var r=t(/*! ./main.vue?vue&type=template&id=a7fa6f7e&scoped=true& */273),o=t(/*! ./main.vue?vue&type=script&lang=js& */275);for(var s in o)"default"!==s&&function(e){t.d(n,e,(function(){return o[e]}))}(s);t(/*! ./main.vue?vue&type=style&index=0&id=a7fa6f7e&lang=less&scoped=true& */277);var i,a=t(/*! ../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */16),d=Object(a["default"])(o["default"],r["render"],r["staticRenderFns"],!1,null,"a7fa6f7e",null,!1,r["components"],i);d.options.__file="pages/cart/productConfirm/main.vue",n["default"]=d.exports},273:
/*!***********************************************************************************************************************************!*\
  !*** C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/cart/productConfirm/main.vue?vue&type=template&id=a7fa6f7e&scoped=true& ***!
  \***********************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(e,n,t){"use strict";t.r(n);var r=t(/*! -!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./main.vue?vue&type=template&id=a7fa6f7e&scoped=true& */274);t.d(n,"render",(function(){return r["render"]})),t.d(n,"staticRenderFns",(function(){return r["staticRenderFns"]})),t.d(n,"recyclableRender",(function(){return r["recyclableRender"]})),t.d(n,"components",(function(){return r["components"]}))},274:
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/cart/productConfirm/main.vue?vue&type=template&id=a7fa6f7e&scoped=true& ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(e,n,t){"use strict";var r;t.r(n),t.d(n,"render",(function(){return o})),t.d(n,"staticRenderFns",(function(){return i})),t.d(n,"recyclableRender",(function(){return s})),t.d(n,"components",(function(){return r}));var o=function(){var e=this,n=e.$createElement;e._self._c},s=!1,i=[];o._withStripped=!0},275:
/*!*****************************************************************************************************************!*\
  !*** C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/cart/productConfirm/main.vue?vue&type=script&lang=js& ***!
  \*****************************************************************************************************************/
/*! no static exports found */function(e,n,t){"use strict";t.r(n);var r=t(/*! -!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./main.vue?vue&type=script&lang=js& */276),o=t.n(r);for(var s in r)"default"!==s&&function(e){t.d(n,e,(function(){return r[e]}))}(s);n["default"]=o.a},276:
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/cart/productConfirm/main.vue?vue&type=script&lang=js& ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=o(t(/*! ./node_modules/@babel/runtime/regenerator */10));function o(e){return e&&e.__esModule?e:{default:e}}function s(e,n,t,r,o,s,i){try{var a=e[s](i),d=a.value}catch(u){return void t(u)}a.done?n(d):Promise.resolve(d).then(r,o)}function i(e){return function(){var n=this,t=arguments;return new Promise((function(r,o){var i=e.apply(n,t);function a(e){s(i,r,o,a,d,"next",e)}function d(e){s(i,r,o,a,d,"throw",e)}a(void 0)}))}}var a=function(){t.e(/*! require.ensure | components/common/button/button */"components/common/button/button").then(function(){return resolve(t(/*! @/components/common/button/button */553))}.bind(null,t)).catch(t.oe)},d=function(){t.e(/*! require.ensure | components/cart/confirm/address */"components/cart/confirm/address").then(function(){return resolve(t(/*! @/components/cart/confirm/address */862))}.bind(null,t)).catch(t.oe)},u=function(){t.e(/*! require.ensure | components/cart/confirm/goods */"components/cart/confirm/goods").then(function(){return resolve(t(/*! @/components/cart/confirm/goods */869))}.bind(null,t)).catch(t.oe)},c={components:{Btn:a,AddressPanel:d,GoodsPanel:u},data:function(){return{loading:!0,goods_id:0,goods_num:1,spec_id:0,goods_list:null,coupon_list:[],is_group:"",group_head_order_sn:"",invoice_type:0,invoice_id:0,remark:"",total_price:0,order_sn:"",can_submit:!0,panel_key:0,is_coupon:!0,expected:null,integration:null,deductionIntegration:0,receiveDate:null,addressId:"",needInitReceiveDate:!0,needInitDeductionIntegration:!0,needInitAddress:!0,needConfirm:!0,address:{}}},onLoad:function(e){},mounted:function(){this.can_submit=!0,this.panel_key++,this.getQuery(),this.getConfirmData()},onShow:function(){this.getStorage(),this.getConfirmData()},onUnload:function(){this.reSet()},methods:{reSet:function(){this.expected=null,this.integration=null,this.address="",this.goods_list="",this.coupon_list=[],this.total_price=0,this.deductionIntegration=0,this.needInitReceiveDate=!0,this.needInitDeductionIntegration=!0,this.needInitAddress=!0,this.needConfirm=!0},initAddressId:function(){this.needInitAddress&&(this.addressId=this.address?this.address.address_id:"",this.needInitAddress=!1)},initReceiveDate:function(){!0===this.needInitReceiveDate&&this.$refs.goodsPanel&&(this.$refs.goodsPanel.initReceiveDate(this.expected.expected_receive_date),this.needInitReceiveDate=!1,console.log("重置到货日期"))},initDeductionIntegration:function(){!0===this.needInitDeductionIntegration&&this.integration&&(this.deductionIntegration=parseInt(this.integration.best_integration),this.needInitDeductionIntegration=!1)},addressChange:function(e){this.address=e,this.addressId=e.address_id,this.needInitReceiveDate=!0},getQuery:function(){var e=this.$root.$mp.query;console.log(e),this.goods_id=e.goods_id,this.goods_num=e.goods_num,this.spec_id=e.spec_id,this.is_group=Number(e.is_group),this.group_head_order_sn=e.group_head_order_sn,this.is_coupon=1===Number(e.is_coupon),this.loading=!1},getConfirmData:function(){var e=this;return i(r.default.mark((function n(){var t,o,s,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(console.log("this.needConfirm",e.needConfirm),e.needConfirm){n.next=3;break}return n.abrupt("return",!1);case 3:if(console.log("this.needConfirm-",e.needConfirm),e.goods_id){n.next=6;break}return n.abrupt("return",!1);case 6:if(1!==e.is_group){n.next=9;break}return e.getGroupConfirmData(),n.abrupt("return");case 9:return t="",e.$refs.goodsPanel&&(o=e.$refs.goodsPanel.coupon_index,t=parseInt(o)>=0?e.coupon_list[o].coupon_instance_id:""),s={url:e.api("confirmProductOrder"),data:{goods_id:e.goods_id,spec_id:e.spec_id,goods_num:e.goods_num,coupon_instance_id:t,is_group:e.is_group,group_head_order_sn:e.group_head_order_sn,integration:e.deductionIntegration,address_id:e.addressId||e.address.address_id||""},loading:!1},console.log("args--",s),n.next=15,e.get(s);case 15:i=n.sent,i.status?(e.total_price=i.data.total_price,e.address=i.data.address?i.data.address:null,e.goods_list=i.data.goods_list?i.data.goods_list:null,e.coupon_list=i.data.coupon_instances?i.data.coupon_instances:null,e.expected=i.data.expected?i.data.expected:null,e.integration=i.data.integration?i.data.integration:null,e.initAddressId(),e.initReceiveDate(),e.initDeductionIntegration()):e.$toast(i.msg);case 17:case"end":return n.stop()}}),n)})))()},getGroupConfirmData:function(){var e=this;return i(r.default.mark((function n(){var t,o,s,i;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(console.log("this.needConfirm",e.needConfirm),e.needConfirm){n.next=3;break}return n.abrupt("return",!1);case 3:return console.log("this.needConfirm-",e.needConfirm),t="",e.$refs.goodsPanel&&(o=e.$refs.goodsPanel.coupon_index,t=parseInt(o)>=0?e.coupon_list[o].coupon_instance_id:""),s={url:e.api("groupConfirmOrder"),data:{goods_id:e.goods_id,coupon_instance_id:t,group_head_order_sn:e.group_head_order_sn,integration:e.deductionIntegration,address_id:e.addressId||e.address.address_id||""},loading:!1},console.log("args--",s),n.next=10,e.get(s);case 10:i=n.sent,i.status?(e.total_price=i.data.total_price,e.address=i.data.address?i.data.address:null,e.goods_list=i.data.goods_list?i.data.goods_list:null,e.coupon_list=i.data.coupon_instances?i.data.coupon_instances:null,e.expected=i.data.expected?i.data.expected:null,e.integration=i.data.integration?i.data.integration:null,e.initAddressId(),e.initReceiveDate(),e.initDeductionIntegration()):e.$toast(i.msg);case 12:case"end":return n.stop()}}),n)})))()},getStorage:function(){var e=this;wx.getStorage({key:"invoice",success:function(n){e.invoice_id=n.data.id,e.invoice_type=n.data.type}})},onAddOrder:function(){console.log("onAddOrder"),this.address?this.addCartOrder():this.$toast("请选择收货地址")},addCartOrderGroup:function(){var e=this;return i(r.default.mark((function n(){var t,o,s,i,a,d,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(e.can_submit){n.next=3;break}return e.$toast("请不要重复提交"),n.abrupt("return");case 3:return e.can_submit=!1,t=e.$refs.goodsPanel.pay_list,o=e.$refs.goodsPanel.pay_index,s="",e.$refs.goodsPanel&&(i=e.$refs.goodsPanel.coupon_index,s=parseInt(i)>=0?e.coupon_list[i].coupon_instance_id:""),a={url:e.api("groupAddOrder"),data:{address_id:e.addressId||e.address.address_id||"",goods_id:e.goods_id,bill_id:e.invoice_id,pay_type:t[o].type,remark:e.remark,coupon_instance_id:s,group_head_order_sn:e.group_head_order_sn,integration:e.deductionIntegration,updatin_expected_receive_date:e.receiveDate},loading:!0,title:"提交中"},console.log("args--",a),n.next=12,e.post(a);case 12:d=n.sent,d.status?(u=d.data,e.order_sn=u.order_sn,e.group_head_order_sn=u.group_head_order_sn,1===Number(u.is_pay)?(0===e.is_group?e.$nav("orderDetail",{order_sn:e.order_sn},!0):e.$nav("team",{order_sn:e.order_sn,group_head_order_sn:e.group_head_order_sn,product_type:0}),e.can_submit=!0):e.payOrder(u.order_sn),e.$Bus.$emit("onAddCart")):(e.$toast(d.msg),e.can_submit=!0);case 14:case"end":return n.stop()}}),n)})))()},addCartOrder:function(){var e=this;return i(r.default.mark((function n(){var t,o,s,i,a,d,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(1!==e.is_group){n.next=3;break}return e.addCartOrderGroup(),n.abrupt("return");case 3:if(e.can_submit){n.next=6;break}return e.$toast("请不要重复提交"),n.abrupt("return");case 6:return e.can_submit=!1,t=e.$refs.goodsPanel.pay_list,o=e.$refs.goodsPanel.pay_index,s="",e.$refs.goodsPanel&&(i=e.$refs.goodsPanel.coupon_index,s=parseInt(i)>=0?e.coupon_list[i].coupon_instance_id:""),a={url:e.api("addProductOrder"),data:{goods_id:e.goods_id,goods_num:e.goods_num,spec_id:e.spec_id,bill_id:e.invoice_id,address_id:e.addressId||e.address.address_id||"",pay_type:t[o].type,remark:e.remark,coupon_instance_id:s,is_group:e.is_group,group_head_order_sn:e.group_head_order_sn,integration:e.deductionIntegration,updatin_expected_receive_date:e.receiveDate},loading:!0,title:"提交中"},n.next=14,e.post(a);case 14:d=n.sent,d.status?(u=d.data,e.order_sn=u.order_sn,1===Number(u.is_pay)?(0===e.is_group?e.$nav("orderDetail",{order_sn:e.order_sn},!0):e.$nav("team",{order_sn:e.order_sn,group_head_order_sn:e.group_head_order_sn,product_type:0}),e.can_submit=!0):e.payOrder(u.order_sn),e.$Bus.$emit("onAddCart")):(e.$toast(d.msg),e.can_submit=!0);case 16:case"end":return n.stop()}}),n)})))()},payOrder:function(e){var n=this;return i(r.default.mark((function t(){var o,s,i;return r.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return o={url:n.api("payOrder"),data:{order_sn:e}},t.next=3,n.get(o);case 3:s=t.sent,s.status?(i=s.data,i.pay_type&&2===Number(i.pay_type)?n.$nav("orderDetail",{order_sn:e},!0):n.wxPay(i)):(n.$toast(s.msg),n.can_submit=!0);case 5:case"end":return t.stop()}}),t)})))()},wxPay:function(e){var n=this,t=this;console.log("微信支付"),this.needConfirm=!1,wx.requestPayment({timeStamp:e.timeStamp+"",nonceStr:e.nonceStr,package:e.package,signType:"MD5",paySign:e.paySign,success:function(e){t.$toast("支付成功","success"),setTimeout((function(){console.log("success-跳转订单详情"),n.reSet(),0===t.is_group?t.$nav("orderDetail",{order_sn:t.order_sn},!0):t.$nav("team",{order_sn:t.order_sn,group_head_order_sn:t.group_head_order_sn,product_type:0}),t.can_submit=!0}),1500)},fail:function(e){"requestPayment:fail cancel"===e.errMsg?t.$toast("支付取消"):t.$toast("支付失败"),setTimeout((function(){console.log("fail-跳转订单详情"),t.reSet(),t.$nav("orderDetail",{order_sn:t.order_sn},!0),t.can_submit=!0}),1500)}})},simulationPay:function(){var e=this;this.$toast("模拟支付");var n={url:this.api("simulationPay"),data:{order_sn:this.order_sn}};this.get(n).then((function(n){e.$nav("orderDetail",{order_sn:e.order_sn},!0)}))}},onPullDownRefresh:function(){wx.stopPullDownRefresh(),this.getConfirmData()}};n.default=c},277:
/*!**************************************************************************************************************************************************!*\
  !*** C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/cart/productConfirm/main.vue?vue&type=style&index=0&id=a7fa6f7e&lang=less&scoped=true& ***!
  \**************************************************************************************************************************************************/
/*! no static exports found */function(e,n,t){"use strict";t.r(n);var r=t(/*! -!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--10-oneOf-1-2!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src??ref--10-oneOf-1-3!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-4!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--10-oneOf-1-5!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!../../../../../../../../MyProgram/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./main.vue?vue&type=style&index=0&id=a7fa6f7e&lang=less&scoped=true& */278),o=t.n(r);for(var s in r)"default"!==s&&function(e){t.d(n,e,(function(){return r[e]}))}(s);n["default"]=o.a},278:
/*!**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--10-oneOf-1-2!./node_modules/postcss-loader/src??ref--10-oneOf-1-3!./node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--10-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!C:/Users/Idler/Documents/HBuilderProjects/iKu/pages/cart/productConfirm/main.vue?vue&type=style&index=0&id=a7fa6f7e&lang=less&scoped=true& ***!
  \**********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(e,n,t){}},[[271,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/cart/productConfirm/main.js.map